ROOT_DIR:=../..
include $(ROOT_DIR)/software/software.mk
include $(CACHE_DIR)/software/software.mk

#specific compiler flags
CFLAGS+=-Wl,-Bstatic,-T,../template.lds,-Map,boot.map,--strip-debug

#specific sources
SRC+=$(BOOT_SRC_DIR)/boot.S $(BOOT_SRC_DIR)/boot.c 

run: boot.elf

boot.elf: ../template.lds  $(HDR) $(SRC)
	$(TOOLCHAIN_PREFIX)gcc -o $@ $(CFLAGS) $(DEFINE) $(INCLUDE) $(SRC) -lgcc -lc
	$(TOOLCHAIN_PREFIX)objcopy -O binary boot.elf boot.bin
	$(PYTHON_DIR)/makehex.py boot.bin $(BOOTROM_ADDR_W) > boot.hex

clean:
	@rm -rf boot.bin boot.elf boot.map *.hex ../periphs.h *~

.PHONY: clean
